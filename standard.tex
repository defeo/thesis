We have seen in Chapter~\ref{chap:lattice} two independant methods to create
lattices of compatibly embedded finite fields. In this Chapter, we present a new
framework, inspired by both Conway polynomials and Bosma-Canon-Steel, that we
call \emph{standard lattice of compatibly embedded finite fields}.
\minitoc

% TODO: Figure

\clearpage

\section{Lenstra-Allombert algorithm and lattices of embeddings}
\label{sec:lenstra-allombert-embeddings}

The two methods of Chapter~\ref{chap:lattice} both have their drawbacks: Conway
polynomials are expensive to compute and thus need to be precomputed, making
them inefficient for large extensions, while Bosma-Canon-Steel needs more
computation each time an embedding is added in the lattice. % Not precise enough/!\
Our starting point in order to propose an alternative framework for lattices of
compatibly embedded finite fields is Lenstra-Allombert algorithm and the study
of Kummer algebras done in Section~\ref{sec:kummer-algebras}. In all this
chapter, $\K=\mathbb{F}_p$ is a prime field of cardinality $p$, where
$p\in\mathbb{N}$ is a prime number.

\subsection{From isomorphism to embedding}
\label{sec:iso-to-emb}

Let us first recall Lenstra-Allombert \emph{isomorphism} algorithm. We keep the
notations of Section~\ref{sec:allombert}, where the details can be found. Let $K$ and
$L$ be two finite fields with $p^n$ elements, where $\gcd(p, n) = 1$, \ie
\[
  p\nmid n.
\]
We know that $K$ and $L$ are isomorphic and, if $\zeta$ is a primitive $n$-th
root of unity taken in the algebraic closure $\bar{\mathbb{F}}_p$ of $\K$, we know
% Note:
% =====
%
% We did not speak about algebraic closure in Chapter 5, where we introduce the
% notions of isomorphisms and algorithms to compute them. It is probably wise
% not to introduce that here only.
we can find an isomorphism by
finding two solutions $\alpha_K$ and $\alpha_L$ to the equation~\eqref{eq:h90-kummer}
\[
  (\sigma\otimes1)(\alpha) = (1\otimes\zeta)\alpha,
\]
respectively in $K\otimes\mathbb{F}_p(\zeta)$ and $L\otimes\mathbb{F}_p(\zeta)$.
We then compute $\kappa\in\mathbb{F}_p(\zeta)$ such that
\[
  1\otimes\kappa^n = \alpha_K^n/\alpha_L^n
\]
and the map
\[
  \phi:\first{\alpha_K}{\zeta}\mapsto\first{(1\otimes\kappa)\alpha_L}{\zeta}
\]
is then an isomorphism from $K$ to $L$. A key part of the algorithm is that the
root $\zeta$ must be the same in the two Kummer algebras
$K\otimes\mathbb{F}_p(\zeta)$ and $L\otimes\mathbb{F}_p(\zeta)$. In practice, it
means that we need to use elements that have the same minimal polynomial to
define $\zeta$ in both algebras. This constraint might seem easy to fulfill in
this case, but it becomes harder in the case of a \emph{compatible embedding}
computation. Assume that $m, n\in\mathbb{N}$ are two integers such that
\[
  m\mid n
\]
and $\gcd(p, m)=\gcd(p, n)=1$. Let $K$ be a finite field with $p^m$ elements and
$L$ a finite fields with $p^n$ elements. We know that $K$ is isomorphic to a
subfield of $L$, \ie we have an embedding
\[
  K\emb L.
\]
To compute an embedding, one solution is to compute the algebras
$K\otimes\mathbb{F}_p(\zeta_m)$ and
$L\otimes\mathbb{F}_p(\zeta_m)$, where $\zeta_m$ is a primitive $m$-th root of
unity, as done in the isomorphism case, then compute solutions
$\alpha_{K, m}, \alpha_{L, m}$ of~\eqref{eq:h90-kummer} and the constant
$\kappa=\kappa_{K\emb L}$. This solution is satisfying as long as we only want
to compute a \emph{single} embedding in $L$. Indeed, assume we also have an
integer $l\in\mathbb{N}$ that divides $n$, such that $\gcd(p, l)=1$, and a
finite field $H$ of cardinality $p^l$. Then there is an embedding
\[
  H\emb L,
\]
and in order to compute it we must find a primitive $l$-th root of unity
$\zeta_l$, compute $L\otimes\mathbb{F}_p(\zeta_l)$, compute a new solution
$\alpha_{L, l}$ of~\eqref{eq:h90-kummer} for $\zeta_l$ and the associated
constant $\kappa_{H\emb L}$. Therefore, each new embedding comes with the
computation of a new Kummer algebra, a new solution of~\eqref{eq:h90-kummer}, and a
new element $\kappa$. We must also store the elements $\kappa$ and the elements
defining the embeddings. Now, recall that if we want to use Bosma-Canon-Steel
framework in order to compatibly embed $K$ in $L$, we must reccursively embed
the intersections $K\cap M$ of each already embedded subfield $M$ of $L$ with $K$ in both $K$
and $L$.
\begin{center}
  \begin{tikzpicture}
    \node (K) at (0, 2) {$K$};
    \node (L) at (2, 4) {$L$};
    \node (M) at (4, 2) {$M$};
    \node (I) at (2, 0) {$K\cap M$};
    \node (?) at (1, 1) {\textbf{?}};
    \node (??) at (3, 1) {\textbf{?}};

    \draw[dashed-arrow] (K) to (L);
    \draw[arrow] (M) to (L);
    \draw[possible-arrow] (I) to (K);
    \draw[possible-arrow] (I) to (M);
  \end{tikzpicture}
\end{center}
This yields a quadratic memory complexity in the number of extensions in the
lattice and their degrees, as well as a quadratic number of new embedding
computations, \ie computations of Kummer algebras and solutions
of~\eqref{eq:h90-kummer}. It motivates a new solution with only one computation
of Kummer algebra and~\eqref{eq:h90-kummer} solution per extension in the lattice,
independently of the number of embedded subfields. Assume we have $\zeta_m$ and
$\zeta_n$ respectively two $m$-th and $n$-th primitive roots
of unity that are \emph{compatible}, \ie such that
\[
  (\zeta_n)^{n/m} = \zeta_m.
\]
We compute the Kummer algebras $K\otimes\mathbb{F}_{p}(\zeta_m)$ and
$L\otimes\mathbb{F}_p(\zeta_n)$, $\alpha_K$ a solution of~\eqref{eq:h90-kummer}
for the root $\zeta_m$ and $\alpha_L$ a solution of~\eqref{eq:h90-kummer} for
the root $\zeta_n$. In that case, the element
\[
  (\alpha_L)^{n/m}\in L\otimes\mathbb{F}_p(\zeta_n)
\]
is a solution of~\eqref{eq:h90-kummer} for the root $(\zeta_n)^{n/m}=\zeta_m$,
indeed
\begin{align*}
  (\sigma\otimes1)((\alpha_L)^{n/m}) &=
  ( (\sigma\otimes1)(\alpha_{L}))^{n/m} \\
  &= ( (1\otimes\zeta_n)\alpha_L)^{n/m}\\
  &= (1\otimes (\zeta_n)^{n/m})(\alpha_L)^{n/m}.
\end{align*}
The embedding $K\emb L$ is then described by
\[
  \first{\alpha_K}{\zeta_m}\mapsto\first{(1\otimes\kappa_{K\emb
  L})(\alpha_L)^{n/m}}{(\zeta_n)^{n/m}},
\]
where $\kappa_{K\emb L}\in\mathbb{F}_p(\zeta_n)$ is a $m$-th root of
$\alpha_L^n/\alpha_K^m$. There are still two issues with such a solution. First,
it is still necessary to store the constants $\kappa_{K\emb L}$ for each
embedding
\[
  K\emb L
\]
in the lattice. We would like these constants $\kappa$ to be equal to $1$, or
maybe that a close formula exists for these constants, by choosing special
solutions $\alpha$ of~\eqref{eq:h90-kummer}. We achieve the latter
by constructing \emph{standard} solutions of~\eqref{eq:h90-kummer} in
Section~\ref{sec:standard-solution}.

\subsection{Cyclotomic lattices}

The second, and most important, issue is the compatibility condition between the
roots of unity $\zeta$. When we write a compatibility condition like
\[
  \zeta_m = (\zeta_n)^{n/m},
\]
we implicitly states that there is a natural inclusion 
\[
  \mathbb{F}_p(\zeta_m)\subset\mathbb{F}_p(\zeta_n)
\]
that makes the embedding from $\mathbb{F}_{p}(\zeta_m)$ to
$\mathbb{F}_{p}(\zeta_n)$ trivial, \ie the embedding is the identity in that
case. In practice, this is not always the situation at hand. For example,
if for some reason the root $\zeta_m$ already exists in some field
$\mathbb{F}_{p^a}$ in the current state of our computer algebra system, and if the
root $\zeta_n$ lives in a strictly bigger field
$\mathbb{F}_{p^b}=\mathbb{F}_p(\zeta_n)$ that we have to compute, then the field
$\mathbb{F}_{p^a}$ is not included in the field $\mathbb{F}_{p^b}$, and the
embedding
\[
  \mathbb{F}_{p^a}\emb \mathbb{F}_{p^b}
\]
is not trivial. In the general case, if we want to use Lenstra-Allombert
embedding algorithm, what we need is a \emph{cyclotomic
lattice}, given by Definition~\ref{defi:cyclotomic-lattice}.
\begin{defi}[Cyclotomic lattice]
  \label{defi:cyclotomic-lattice}
  A \emph{cyclotomic lattice} is composed of two things:
  \begin{itemize}
    \item a collection
  \[
    \mathcal S^I = \left\{ (K_m, \zeta_m) \right\}_{m\in I}
  \]
  over some support set $I\subset \mathbb{N}\setminus p\mathbb{N}$. The element
  $K_m$ is an explicitly represented finite extension of $\K=\mathbb{F}_p$, and
  the element $\zeta_m\in K_m$ is a generating element of $K_m$ that is also a
  primitive $m$-th root of unity, \ie we have
  \[
  K_m = \mathbb{F}_{p}(\zeta_m)
  \]
  and
  \[
  (\zeta_m)^m=1.
  \]
    \item explicit embeddings
      \[
        \begin{array}{llll}
          \iota_{m, n}: & K_m & \emb & K_n\\
          & \zeta_m & \mapsto & (\zeta_n)^{n/m}
        \end{array}
      \]
      whenever $(m, n)\in I^2$ are such that $m\mid n$.
  \end{itemize}
\end{defi}

Again, there is no problem if we know beforehand all the degrees of the
extensions in the lattice that we will use, \ie if the support set $I$ is
finite. Indeed, in that case there is an efficient randomised algorithm to
compute the cyclotomic lattice: consider
\[
  N = \lcm_{m\in I}(m)
\]
and construct the smallest finite field $\mathbb{F}_{p^a}$ such that $N$ divides
$p^a-1$, \ie the smallest finite field containing an $N$-th primitive root of
unity. Then take $x\in\mathbb{F}_{p^a}$ at random, compute 
\[
  y=x^{(p^a-1)/N}
\]
and check that the multiplicative order of $y$ is $N$. If it is, we can
construct all roots $\zeta_m$ as powers of this element:
\[
  \zeta_m = y^{N/m}
\]
for all $m\in I$, and we can set
\[
  K_m = \mathbb{F}_p(\zeta_m)\subset \mathbb{F}_{p^a}
\]
and let the embeddings $\iota_{m, n}$ be natural inclusions. But once again,
this methode does not produce an incremental lattice, thus it is not really user
friendly: one would like to have a lattice where new elements can be added on
the fly. Conway polynomials, that were introduced in
Section~\ref{sec:conway} in order to construct a lattice of
compatibly embedded finite fields, offer an other example of cyclotomic lattice. In
fact, a cyclotomic lattice is always a lattice of compatibly embedded finite
fields, because each time we have $l, m, n\in I$ with
\[
  l\mid n\mid n,
\]
we have
\[
  (\zeta_n)^{n/l} = ((\zeta_n)^{m/l})^{n/m}
\]
and it follows that
\[
  \iota_{l, n} = \iota_{m, n}\circ\iota_{l, m}.
\]
One can thus wonder why we need a structure than can be used to represent a
lattice of compatibly embedded finite fields, precisely to construct a lattice
of compatibly embedded finite fields. In fact, we will see in the next sections
that with a fairly small cyclotomic lattice, we are able to construct a much larger
lattice of compatibly embedded finite fields, thus making the whole construction
interesting, above all if the cyclotomic lattice is incrementable, like with
Conway polynomials. In the next sections, we consider that we have an abstract
cyclotomic lattice, without precising any particular construction. We only
assume that we have a collection $\mathcal S^I$ satisfying the conditions of
Definition~\ref{defi:cyclotomic-lattice}.

\subsection{Kummer embeddings}
\label{sec:kummer-embeddings}

As we have seen in the last sections, asking for a compatibility condition
\[
  \zeta_m = (\zeta_n)^{n/m}
\]
each time we want to use Lenstra-Allombert embedding algorithm to embed
$\mathbb{F}_{p^m}$ in $\mathbb{F}_{p^n}$, in a compatible way, is not trivial:
it requires the availability of a cyclotomic lattice. Moreover, this equation
implies that there is a natural inclusion
\[
  \mathbb{F}_{p}(\zeta_m)\subset\mathbb{F}_{p}(\zeta_n),
\]
which is not the case in general. In order to be as thorough as possible, we
will thus write
\[
  \iota_{m, n}(\zeta_m) = (\zeta_{n})^{n/m}
\]
and generalize the discussion of Section~\ref{sec:iso-to-emb} and the results of
Section~\ref{sec:lenstra-allombert-isomorphism} in this setting. We keep the
``Kummer algebra'' terminology, already used in
Section~\ref{sec:kummer-algebras}, that is based on~\cite{DRR19}. We know assume
that a cyclotomic lattice $\mathcal S^I$ is available. Let
\[
  m\mid n
\]
be two integers prime to $p$, we then have an embedding
\[
\begin{array}{cccc}
  \iota_{m, n}: & \mathbb{F}_{p}(\zeta_m)& \emb &\mathbb{F}_{p}(\zeta_n)\\
  & \zeta_m & \mapsto & (\zeta_n)^{n/m}.
\end{array}
\]
We also let
\[
  A_m=\mathbb{F}_{p^m}\otimes\mathbb{F}_{p}(\zeta_m)
\]
and
\[
  A_n=\mathbb{F}_{p^n}\otimes\mathbb{F}_{p}(\zeta_n)
\]
two Kummer algebras. As was the case for
Lenstra-Allombert \emph{isomorphism} algorithm, we want to deduce a field
embedding from an algebra embedding between $A_m$ and $A_n$, using the
properties of the solutions of~\eqref{eq:h90-kummer}. We are thus
interested in a special class of morphisms that are closely linked with
these solutions.
\begin{defi}[Kummer embedding]
  \label{defi:kummer-embedding}
  A \emph{Kummer embedding} of $A_m$ into $A_n$ is an injective
  $\K$-algebra morphism
  \[
    \Phi:A_m\emb A_n
  \]
  such that:
  \begin{itemize}
    \item the morphism $\Phi$ extends the scalar embedding
      $1\otimes\iota_{m,n}$;
    \item the morphism $\Phi$ commutes with $\sigma\otimes1$.
  \end{itemize}
\end{defi}
We can in fact give a simpler characterization of Kummer embeddings, and see that
they are of the form $\Phi=\phi\otimes\iota$, where $\iota$ is the embedding
described by the cyclotomic lattice $\mathcal S^I$. The embedding $\phi$ is then the one for
which we will try to obtain a description, using the properties of the solutions
of~\eqref{eq:h90-kummer}.
\begin{prop}
  \label{prop:correspondence-embeddings}
  There is a $1$-to-$1$ correspondence between Kummer embeddings
  \[
    \Phi:A_m\emb A_n
  \]
  and embeddings of finite fields
  \[
    \phi:\mathbb{F}_{p^m}\emb\mathbb{F}_{p^n},
  \]
  given by:
  \begin{itemize}
    \item if $\Phi$ is a Kummer embedding, then $\Phi$ maps
      $\mathbb{F}_{p^m}\otimes1$ into $\mathbb{F}_{p^n}\otimes1$. Thus the
      restriction of $\Phi$ to $\mathbb{F}_{p^m}$ is of the form $\phi\otimes1$
      for some embedding $\phi:\mathbb{F}_{p^m}\emb\mathbb{F}_{p^n}$, and we
      have $\Phi=\phi\otimes\iota_{m, n}$;
    \item conversely, if $\phi:\mathbb{F}_{p^m}\emb\mathbb{F}_{p^n}$ is an
      embedding of finite fields, then $\Phi=\phi\otimes\iota_{m, n}$ is a
      Kummer embedding.
  \end{itemize}
  In conclusion, the correspondence is given by
  \[
    \Phi=\phi\otimes\iota_{m, n}\longleftrightarrow \phi.
  \]
  Moreover, this correspondence commutes with composition of embeddings.
\end{prop}
\begin{proof}
 Let $\Phi:A_m\emb A_n$ be a Kummer embedding. Since $\Phi$ is an algebra
 morphism, we have 
 \[
   \Phi(\beta^p) = \Phi(\beta)^p
 \]
for all $\beta\in A_m$. Since $(\sigma\otimes\sigma)(\beta) = \beta^p$, this
proves that $\Phi$ commutes with $\sigma\otimes\sigma$. It also
commutes with $\sigma\otimes1$, and thus with its inverse $\sigma^{-1}\otimes1$.
In then also commutes with
\[
  (\sigma^{-1}\otimes1)\circ(\sigma\otimes\sigma) = 1\otimes\sigma.
\]
Now, if $\beta\in\mathbb{F}_{p^m}\otimes1$, we know thanks
to Remark~\ref{rem:fixed-elems} that it is fixed by $1\otimes\sigma$, thus we have that
\begin{align*}
 (1\otimes\sigma)\circ\Phi(\beta) &= \Phi\circ(1\otimes\sigma)(\beta)\\
 &= \Phi(\beta).
\end{align*}
Again, using Remark~\ref{rem:fixed-elems}, we then know that
$\Phi(\beta)\in\mathbb{F}_{p^n}\otimes1$. This proves that
$\mathbb{F}_{p^m}\otimes1$ is mapped into $\mathbb{F}_{p^n}\otimes1$. Now, it
means that every element of the form $x\otimes1$ with $x\in\mathbb{F}_{p^m}$ is
mapped to an element of the form $\Phi(x\otimes1)=y\otimes1$ with $y\in\mathbb{F}_{p^m}$.
Because $\Phi$ is a morphism of algebras, if we
let $\phi(x)=y$, we can check that
\[
  \phi:\mathbb{F}_{p^m}\to\mathbb{F}_{p^n}
\]
is also a morphism. Therefore, the restriction of $\Phi$ on
$\mathbb{F}_{p^m}$ is of the form $\phi\otimes1$, where
$\phi:\mathbb{F}_{p^m}\emb\mathbb{F}_{p^n}$ is an embedding
of finite fields. We conclude that $\Phi=\phi\otimes\iota_{m, n}$. Indeed, if 
\[
  \beta=\sum_{j}x_j\otimes y_j
\]
is an element of the Kummer algebra $A_m$, we then have
\begin{align*}
  \Phi(\beta) &= \Phi(\sum_{j}x_j\otimes y_j) \\
  &= \sum_j\Phi(x_j\otimes y_j)\\
  &= \sum_j\Phi(x_j\otimes1)\times\Phi(1\otimes y_j)\\
  &= \sum_j(\phi\otimes1)(x_j\otimes1)\times(1\otimes\iota_{m, n})(1\otimes y_j)\\
  &= \sum_j (\phi(x_j)\otimes1)\times(1\otimes\iota_{m, n}(y_j))\\
  &= \sum_j \phi(x_j)\otimes\iota_{m, n}(y_j)\\
  &= \sum_j (\phi\otimes\iota_{m, n})(x_j\otimes y_j)\\
  &= (\phi\otimes\iota_{m, n})(\sum_jx_j\otimes y_j),
\end{align*}
and thus
\[
  \Phi(\beta) = (\phi\otimes\iota_{m, n})(\beta)
\]
for every element $\beta\in A_m$.

Conversely, if $\phi:\mathbb{F}_{p^{m}}\emb\mathbb{F}_{p^n}$ is an embedding of
finite fields and if we define
\[
  \Phi = \phi\otimes\iota_{m, n},
\]
we see that $\Phi$ is a morphism of $\K$-algebras that extends the scalar embedding
$\iota_{m, n}$ by definition.
The embedding $\phi$ is a power of the Frobenius automorphism $\sigma$ and thus
commutes with $\sigma$, hence $\sigma\otimes1$ commutes with
$\Phi=\phi\otimes\iota_{m, n}$, and this proves that $\Phi$ is a Kummer
embedding.

Now, if we have three Kummer algebras $A_l, A_m, A_n$ such that 
\[
  l\mid m\mid n
\]
and two Kummer embeddings $\Phi_{l, m}:A_l\emb A_m$ and $\Phi_{m, n}:A_m\emb
A_n$, we know that there exists $\phi_{l,
m}:\mathbb{F}_{p^l}\emb\mathbb{F}_{p^m}$ and $\phi_{m,
n}:\mathbb{F}_{p^{m}}\emb\mathbb{F}_{p^{n}}$ such that we have the following
diagram.
\begin{center}
    \begin{tikzpicture}
      \node (l) at (0, 0) {$A_l$};
      \node (m) at (0, 1.5) {$A_m$};
      \node (n) at (0, 3) {$A_n$};

      \draw[arrow] (l) -- (m);
      \draw[arrow] (m) -- (n);

      \node (f12) at (2, 0.65)
      {$\Phi_{l,m}=\phi_{l, m}\otimes\iota_{l, m}$};
      \node (f13) at (2, 2.15)
      {$\Phi_{m,n}=\phi_{m, n}\otimes\iota_{m, n}$};
    \end{tikzpicture}
\end{center}
Now the map $\Phi_{m, m}\circ\Phi_{l,m}$ is a Kummer embedding from $A_l$ into
$A_n$, hence there exist an embedding
$\phi:\mathbb{F}_{p^{l}}\emb\mathbb{F}_{p^{n}}$ such that 
\[
  \Phi_{m, m}\circ\Phi_{l,m}=\phi\otimes\iota_{l, n}.
\]
But we also have 
\[
  \Phi_{m, m}\circ\Phi_{l,m}=(\phi_{m, n}\circ\phi_{l,
  m})\otimes(\iota_{m, n}\circ\iota_{l, m}),
\]
and since $\iota_{l,n}=\iota_{m, n}\circ\iota_{l, m}$ by definition, we obtain
\[
  \phi_{m, n}\circ\phi_{l, m}=\phi,
\]
thus the correspondence commutes with compositions of embeddings.
\end{proof}
\begin{prop}
  \label{prop:correspondence-solutions}
  Let $\alpha_m\in A_m$ be a nonzero solution of~\eqref{eq:h90-kummer} for
  $\zeta_m$, and let $c_m$ be its Kummer constant. Then, there is a $1$-to-$1$
  correspondence between Kummer embeddings
  \[
    \Phi:A_l\emb A_m
  \]
  and solutions $\hat\alpha\in A_n$ of~\eqref{eq:h90-kummer} for
  $(\zeta_n)^{m/n}=\iota_{m, n}(\zeta_m)$ that also satisfy
  \[
    \hat\alpha^m = 1\otimes\iota_{m, n}(c_m).
  \]
  The correspondence is given by
  \[
    \Phi(\alpha_m)\longleftrightarrow \hat\alpha.
  \]
\end{prop}
\begin{proof}
Let $\Phi:A_m\emb A_n$ be a Kummer embedding. Lemma~\ref{lm:h90-solutions} shows
that $\alpha_m$ is a generator of $A_m$ as an $1\otimes\mathbb{F}_{p}(\zeta_m)$
algebra. Thus every element $\beta\in A_m$ can be written in the form
\[
  \beta = \sum_{j=0}^{m-1}(1\otimes b_j)(\alpha_m)^j,
\]
and we obtain
\[
  \Phi(\beta) = \sum_{j=0}^{m-1}(1\otimes\iota_{m, n}(b_j))\Phi(\alpha_m)^j,
\]
therefore we see that $\Phi$ is determined by its image $\Phi(\alpha_m)$. Moreover,
$\hat\alpha=\Phi(\alpha_m)$ is a solution of~\eqref{eq:h90-kummer} for
$(\zeta_n)^{n/m}=\iota_{m,n}(\zeta_m)$ that satisfies
$\hat\alpha^m=\iota_{m, n}(c_m)$. Indeed, this is a generalization of the
computations done in Section~\ref{sec:kummer-algebras} and a consequence of
Definition~\ref{defi:kummer-embedding}. We have
\begin{align*}
 (\sigma\otimes1)(\hat\alpha) &=(\sigma\otimes1)(\Phi(\alpha_m))\\
 &= \Phi( (\sigma\otimes1)(\alpha_m))\\
 &= \Phi((1\otimes\zeta_m)\alpha_m)\\
 &= (1\otimes\iota_{m, n})(\zeta_m)\Phi(\alpha_m)\\
 &= (1\otimes\iota_{m, n}(\zeta_m))\hat\alpha
\end{align*}
and
\begin{align*}
 \hat\alpha^m &= \Phi(\alpha_m)^m\\
 &= \Phi(\alpha_m^m)\\
 &= \Phi(1\otimes c_m)\\
 &= 1\otimes\iota_{m, n}(c_m).
\end{align*}

 Converserly, if $\hat\alpha$ is a solution of~\eqref{eq:h90-kummer} for
 $\iota_{m, n}(\zeta_m)$ such that $\hat\alpha^m=\iota_{m, n}(c_m)$, we see that
 \[
  \Phi(\beta) = \sum_{j=0}^{m-1}(1\otimes\iota_{m, n}(b_j))\hat\alpha^j,
 \]
 for any element
 \[
  \beta = \sum_{j=0}^{m-1}(1\otimes b_j)(\alpha_m)^j
 \]
 gives a well-defined morphism of algebras from  $A_m$ into $A_n$ that satisfies
 $\Phi(\alpha)=\hat\alpha$ and
 the conditions in Definition~\ref{defi:kummer-embedding}, \ie it extends
 $\iota_{m, n}$ and commutes with $\sigma\otimes1$.
\end{proof}
With these two correspondences, we can now describe a little more the link
between solutions of~\eqref{eq:h90-kummer} and the finite field embeddings
$\phi$ that we compute from them.
\begin{cor}
  \label{cor:link-h90-embedding}
  Let $\alpha_m\in A_m$ be a nonzero solution of~\eqref{eq:h90-kummer} for
  $\zeta_m$ with Kummer constant $c_m$ and let $\hat\alpha\in A_n$ be a solution
  of~\eqref{eq:h90-kummer} for $(\zeta_n)^{n/m}$ that satisfies
  $\hat{\alpha}^m=\iota_{m, n}(c_m)$. Then
  \begin{itemize}
    \item the solution $\hat{\alpha}$ belongs to the subset
      $\mathbb{F}_{p^{l}}\otimes\mathbb{F}_p((\zeta_n)^{n/m})\subset A_n$;
    \item the assignation
      $\first{\alpha_m}{\zeta_m}\mapsto\first{\hat\alpha}{(\zeta_n)^{n/m}}$
      defines an embedding $\phi:\mathbb{F}_{p^{m}}\emb\mathbb{F}_{p^{n}}$;
    \item the map $\Phi=\phi\otimes\iota_{m, n}$ is the unique Kummer embedding
      such that $\Phi(\alpha_m)=\hat\alpha$.
  \end{itemize}
\end{cor}
\begin{proof}
  By Proposition~\ref{prop:correspondence-solutions}, we know that there exists
  a unique Kummer embedding 
  \[
    \Phi:A_m\emb A_n
  \]
  such that $\Phi(\alpha_m) =
  \hat\alpha$. We also know thanks to
  Proposition~\ref{prop:correspondence-embeddings} that
  \[
    \Phi=\phi\otimes\iota_{m, n}
  \]
  for some embedding of finite fields
  $\phi:\mathbb{F}_{p^{m}}\emb\mathbb{F}_{p^{n}}$. If $\alpha_m =
  \sum_{j=0}^{a-1}x_j\otimes(\zeta_m)^j$, where $a$ is the level of $A_m$, we
  obtain
  \[
    \hat\alpha = \sum_{j=0}^{a-1}\phi(x_j)\otimes(\zeta_n)^{\frac{in}{m}},
  \]
  thus we have $\hat\alpha\in\mathbb{F}_{p^{m}}\otimes\mathbb{F}_{p}(
  (\zeta_n)^{n/m})$. We also see that $x_0=\first{\alpha_m}{\zeta_m}$ is mapped
  to $\phi(x_0) = \first{\hat\alpha}{(\zeta_n)^{n/m}}$, but
  $\first{\alpha_m}{\zeta_m}$ is a generating element of
  $\mathbb{F}_{p^{m}}$ by Proposition~\ref{prop:generate}, hence the assignation
  \[
    \first{\alpha_m}{\zeta_m}\mapsto\first{\hat\alpha}{(\zeta_n)^{n/m}}
  \]
  defines $\phi$.
\end{proof}
With these results we are ready to generalize
Proposition~\ref{prop:lenstra-allombert-algorithm} to the embedding case, with
the cyclotomic lattice setting, giving a minor variation of the original
algorithm of Allombert.
\begin{algorithm}
  \caption{(Allombert's algorithm)}
  \label{algo:allombert}
  \begin{algorithmic}[1]
    \Require{$\mathbb{F}_{p^m}, \mathbb{F}_{p^n}$, for $m\mid n$ integers prime to $p$,
    and a cyclotomic lattice $\mathcal S^{\{l,m\}}$.}
    \Ensure{$s\in \mathbb{F}_{p^m}, t\in\mathbb{F}_{p^n}$, such that the assignation $s\mapsto t$
    defines an embedding $\phi:\mathbb{F}_{p^{m}}\emb\mathbb{F}_{p^n}$.}
  \State Construct the Kummer algebras $A_m$ and $A_n$.
  \State Find $\alpha_m\in A_m$ and $\alpha_n\in A_n$, nonzero solutions
  of~\eqref{eq:h90-kummer} for $\zeta_m$
  and $\zeta_n$ respectively.
  \State Compute their Kummer constants: $(\alpha_m)^m=1\otimes c_m$ and
  $(\alpha_n)^n=1\otimes c_n$.
  \State Compute $\kappa$, a $m$-th root of $\iota_{m, n}(c_m)/c_n$.
  \State Return $\first{\alpha_{m}}{\zeta_m}$ and
  $\first{(1\otimes\kappa)(\alpha_n)^{\frac{n}{m}}}{(\zeta_n)^{\frac{n}{m}}}$.
  \end{algorithmic}
\end{algorithm}
\begin{prop}
  \label{prop:allombert-works}
  Algorithm~\ref{algo:allombert} is correct: it returns elements that define an
  embedding $\phi:\mathbb{F}_{p^{m}}\emb\mathbb{F}_{p^{n}}$.
\end{prop}
\begin{proof}
  The ideas of the proof are the same as the ones found in the proof of
  Proposition~\ref{prop:lenstra-allombert-algorithm}, which were already present
  in the simpler case of Proposition~\ref{prop:allombert-simple}, where all the
  roots of unity are in $\K$. By
  Proposition~\ref{prop:correspondence-embeddings}, let 
  \[
    \Phi=\phi\otimes\iota_{m, n}
  \]
  be a Kummer embedding from $A_m$ into $A_n$. Let $\alpha_m\in A_m$ a solution
  of~\eqref{eq:h90-kummer} for $\zeta_m$ with Kummer constant $c_m$, and let
  $\alpha_n\in A_n$ a solution of~\eqref{eq:h90-kummer} for $\zeta_n$ with
  Kummer constant $c_n$. By
  Proposition~\ref{prop:correspondence-solutions}, there is a solution $\hat\alpha\in
  A_n$ of~\eqref{eq:h90-kummer} for $(\zeta_n)^{n/m}$ that satisfies
  $\hat{\alpha}^m=\iota_{m, n}(c_m)$ and such that $\Phi(\alpha_m)=\hat\alpha$.
  Now, we also have that $(\alpha_n)^{n/m}$ is a solution
  of~\eqref{eq:h90-kummer} for $(\zeta_n)^{n/m}$, and the solutions
  of~\eqref{eq:h90-kummer} for $(\zeta_n)^{n/m}$ form a one-dimensional
  $1\otimes\mathbb{F}_{p}(\zeta_n)$-vector space, so there exists a constant
  $\lambda\in\mathbb{F}_{p}(\zeta_n)$ such that
  \[
    \hat\alpha = (1\otimes\lambda)(\alpha_n)^{n/m}.
  \]
  We conclude that 
  \[
    \cfrac{\iota_{m, n}(c_m)}{c_n} = \lambda^m
  \]
  is a $m$-th root in $\mathbb{F}_{p}(\zeta_n)$. If we let
  \[
    \kappa = (\zeta_n)^{\frac{in}{m}}\lambda,
  \]
  for some integer $i$, be a $m$-th root of $\frac{\iota_{m, n}(c_m)}{c_n}$, it
  follows that
  \[
    \tilde\alpha = (1\otimes\kappa)(\alpha_n)^{n/m} =
    (1\otimes(\zeta_n)^{\frac{in}{m}})\hat\alpha
  \]
  is a solution of~\eqref{eq:h90-kummer} for $(\zeta_n)^{n/m}$ that satisfies
  $\tilde\alpha^m = \iota_{m,n}(c_m)$. By
  Corollary~\ref{cor:link-h90-embedding}, we know that the assignation
  \[
    \first{\alpha_m}{\zeta_m}\mapsto\first{\tilde\alpha}{(\zeta_n)^{n/m}}
  \]
  defines an embedding from $\mathbb{F}_{p^m}$ into $\mathbb{F}_{p^{n}}$.
\end{proof}
\begin{rem}
  Taking the same notations as the one in the proof of
  Proposition~\ref{prop:allombert-works}, we see that the embedding returned by
  the algorithm is $\sigma^i\circ\phi$. Indeed, we have
  \begin{align*}
    \tilde\alpha &= (1\otimes(\zeta_n)^{\frac{in}{m}})\hat\alpha\\
    &= (\sigma\otimes1)^i(\hat\alpha)\\
    &= (\sigma^i\otimes1)(\hat\alpha).
  \end{align*}
  If we let $x_0=\first{\hat\alpha}{(\zeta_n)^{\frac{n}{m}}}$, we wee that the
  returned embedding is defined by the assignation
  \[
    \first{\alpha_m}{\zeta_m}\mapsto\sigma^i(x_0)
  \]
  while $\phi$ is defined by
  \[
    \first{\alpha_m}{\zeta_m}\mapsto x_0.
  \]
\end{rem}
\section{Standard solution of Hilbert $90$}
\label{sec:standard-solution}

We discussed in Section~\ref{sec:iso-to-emb} the fact that there are two main
obstacles when constructing a lattice of compatibly embedded finite fields using
Lenstra-Allombert algorithm. The first one is that we need to have compatibility
between the roots of unity that we use, and that can be hard to obtain in
practice. We solved that problem by assuming the availability of a
cyclotomic lattice $\mathcal S^I$, and we proved that all the results concerning
Lenstra-Allombert can be expressed in that setting in
Section~\ref{sec:kummer-embeddings}. Still, an other problem remains. Indeed,
because we use Bosma-Canon-Steel framework, with each embedding computation
\[
  K\emb L
\]
comes the computation and the storage of some constant
\[
  \kappa_{K\emb L}.
\]
In this section and in Section~\ref{sec:standard-embeddings}, we will see how to
choose special solutions of \eqref{eq:h90-kummer}, in order to manage these
constants.

\section{Standard embeddings}
\label{sec:standard-embeddings}
%
